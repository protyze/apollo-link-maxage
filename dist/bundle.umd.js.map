{"version":3,"file":"bundle.umd.js","sources":["index.js"],"sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = Object.setPrototypeOf ||\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { ApolloLink, Observable } from 'apollo-link';\nimport { getMainDefinition } from 'apollo-utilities';\n// turns 10d into number of ms\nfunction msTime(str) {\n    var types = { ms: 1 };\n    types.s = types.ms * 1000;\n    types.m = types.s * 60;\n    types.h = types.m * 60;\n    types.d = types.h * 24;\n    types.w = types.d * 7;\n    var num = parseInt(str.replace(/[a-z]+/i, ''), 10);\n    var type = str.replace(/[0-9]+/, '');\n    return num * types[type];\n}\nvar MaxAgeLink = /** @class */ (function (_super) {\n    __extends(MaxAgeLink, _super);\n    function MaxAgeLink(options) {\n        var _this = _super.call(this) || this;\n        _this.options = options;\n        _this.scheduled = new Map();\n        return _this;\n    }\n    MaxAgeLink.prototype.request = function (op, forward) {\n        var _this = this;\n        var ctx = op.getContext();\n        var isQuery = getMainDefinition(op.query).operation === 'query';\n        if (!isQuery || !ctx.maxAge || ctx.force === true) {\n            return forward(op);\n        }\n        var key = this.toKey(op);\n        if (this.shouldUseNetwork(key)) {\n            var now = new Date();\n            var maxAge = typeof ctx.maxAge === 'string' ? msTime(ctx.maxAge) : ctx.maxAge;\n            var expirationDate = new Date(now.getTime() + maxAge);\n            this.schedule(key, expirationDate);\n            return forward(op);\n        }\n        return new Observable(function (observer) {\n            try {\n                var data = _this.options.cache.readQuery({\n                    query: ctx.query || op.query,\n                    variables: op.variables,\n                });\n                observer.next({ data: data });\n                observer.complete();\n            }\n            catch (e) {\n                observer.error(e);\n            }\n        });\n    };\n    MaxAgeLink.prototype.shouldUseNetwork = function (key) {\n        return this.isExpired(key) || !this.scheduled.has(key);\n    };\n    MaxAgeLink.prototype.isExpired = function (key) {\n        return this.scheduled.get(key) < new Date();\n    };\n    MaxAgeLink.prototype.schedule = function (key, date) {\n        this.scheduled.set(key, date);\n    };\n    MaxAgeLink.prototype.toKey = function (op) {\n        return this.options.toKey ? this.options.toKey(op) : op.toKey();\n    };\n    return MaxAgeLink;\n}(ApolloLink));\nexport { MaxAgeLink };\n//# sourceMappingURL=index.js.map"],"names":["this","getMainDefinition","Observable","ApolloLink"],"mappings":"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"}